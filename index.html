<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Cronograma Pro Final</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca' },
                        dark: { bg: '#0f172a', card: '#1e293b', border: '#334155' }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-attachment: fixed;
            background-image: radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.08), transparent 25%), radial-gradient(circle at 85% 30%, rgba(236, 72, 153, 0.08), transparent 25%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        .dark .glass-card {
            background: rgba(30, 41, 59, 0.7);
            border-color: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }
        
        /* Dragging Animations */
        .task-item {
            cursor: grab;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .task-item:active { cursor: grabbing; transform: scale(0.98); }
        .task-item.dragging {
            opacity: 0.9;
            background: white;
            transform: scale(1.02) rotate(2deg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            z-index: 50;
            border: 1px solid #6366f1;
        }
        .dark .task-item.dragging { background: #1e293b; border-color: #818cf8; }
        
        .drag-over {
            background-color: rgba(99, 102, 241, 0.05) !important;
            border: 2px dashed #6366f1 !important;
            transform: scale(1.01);
        }

        .progress-ring-circle { transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1); transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeIn 0.6s ease-out forwards; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }

        /* Calendar Styles */
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 9999px; font-size: 0.875rem; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .calendar-day:hover:not(.empty) { background-color: rgba(99, 102, 241, 0.1); }
        .calendar-day.has-history { font-weight: bold; color: white; }
        
        /* Floating Help Panel */
        #helpPanel { transition: opacity 0.3s ease, transform 0.3s ease; }
        #helpPanel.hidden-panel { opacity: 0; pointer-events: none; transform: translateY(10px) scale(0.95); }
        #helpPanel.visible-panel { opacity: 1; pointer-events: all; transform: translateY(0) scale(1); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-slate-50 min-h-screen selection:bg-indigo-500 selection:text-white transition-colors duration-300 overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Constants & Initial Data ---
        const STORAGE_KEY = 'studyScheduleData_React_Final_V3_8'; 
        
        const COLORS = {
            "Física": "#3b82f6", "Matemática": "#6366f1", "Química": "#8b5cf6", "Português": "#ec4899",
            "História": "#f59e0b", "Biologia": "#10b981", "Geografia": "#06b6d4", "Inglês": "#ef4444",
            "Filosofia": "#eab308", "Sociologia": "#64748b", "Redação": "#f43f5e", 
            "Revisão": "#14b8a6", "Default": "#64748b"
        };

        const INITIAL_SCHEDULE = [
            { day: "Segunda-feira", tasks: [{ id: 1, subject: "Física", planned: 240, studied: 0 }, { id: 2, subject: "Matemática", planned: 160, studied: 0 }, { id: 3, subject: "Química", planned: 270, studied: 0 }] },
            { day: "Terça-feira", tasks: [{ id: 4, subject: "Biologia", planned: 270, studied: 0 }, { id: 5, subject: "Português", planned: 180, studied: 0 }, { id: 6, subject: "História", planned: 180, studied: 0 }] },
            { day: "Quarta-feira", tasks: [{ id: 7, subject: "Geografia", planned: 240, studied: 0 }, { id: 8, subject: "Redação", planned: 180, studied: 0 }, { id: 9, subject: "Filosofia", planned: 180, studied: 0 }] },
            { day: "Quinta-feira", tasks: [{ id: 10, subject: "Física", planned: 240, studied: 0 }, { id: 11, subject: "Matemática", planned: 160, studied: 0 }, { id: 12, subject: "Biologia", planned: 270, studied: 0 }] },
            { day: "Sexta-feira", tasks: [{ id: 13, subject: "Química", planned: 270, studied: 0 }, { id: 14, subject: "Inglês", planned: 60, studied: 0 }, { id: 15, subject: "Sociologia", planned: 60, studied: 0 }] },
            { day: "Sábado", tasks: [{ id: 16, subject: "Física", planned: 240, studied: 0 }, { id: 17, subject: "Matemática", planned: 160, studied: 0 }, { id: 18, subject: "Revisão", planned: 120, studied: 0 }] }
        ];

        const formatTime = (mins) => {
            if (isNaN(mins)) return "0h 00min";
            const h = Math.floor(mins / 60);
            const m = mins % 60;
            return `${h}h ${m.toString().padStart(2, '0')}min`;
        };

        // --- Components ---

        const Modal = ({ isOpen, onClose, children, title }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md animate-fade-in">
                    <div className="absolute inset-0" onClick={onClose}></div>
                    <div className="relative bg-white dark:bg-slate-900 w-full max-w-4xl rounded-[2rem] shadow-2xl p-8 border border-slate-100 dark:border-slate-700 max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-6 border-b border-slate-100 dark:border-slate-800 pb-4">
                            <h3 className="text-3xl font-display font-bold text-slate-900 dark:text-white">{title}</h3>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 transition">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [schedule, setSchedule] = useState(INITIAL_SCHEDULE);
            const [essays, setEssays] = useState([]);
            const [history, setHistory] = useState([]);
            const [weights, setWeights] = useState({});
            const [grandTotalHours, setGrandTotalHours] = useState(20);
            const [isDark, setIsDark] = useState(false);
            const [activeModal, setActiveModal] = useState(null);
            const [selectedTask, setSelectedTask] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [currentCalendarDate, setCurrentCalendarDate] = useState(new Date());

            // Essay Form State
            const [essayForm, setEssayForm] = useState({ theme: '', genre: '', grade: '' });

            // Initialize
            useEffect(() => {
                const loadedData = localStorage.getItem(STORAGE_KEY);
                if (loadedData) {
                    try {
                        const parsed = JSON.parse(loadedData);
                        if(parsed.schedule && Array.isArray(parsed.schedule) && parsed.schedule.length > 0) {
                            setSchedule(parsed.schedule);
                        } else {
                             setSchedule(INITIAL_SCHEDULE);
                        }
                        setEssays(parsed.essays || []);
                        setHistory(parsed.history || []);
                        setWeights(parsed.weights || {});
                    } catch (e) { setSchedule(INITIAL_SCHEDULE); }
                } else {
                    setSchedule(INITIAL_SCHEDULE);
                }

                // Init weights
                setWeights(prev => {
                    const newWeights = { ...prev };
                    let changed = false;
                    const allSubjects = new Set();
                    (schedule.length ? schedule : INITIAL_SCHEDULE).forEach(d => d.tasks.forEach(t => allSubjects.add(t.subject)));
                    
                    allSubjects.forEach(sub => {
                        if (!newWeights[sub]) { newWeights[sub] = 1; changed = true; }
                    });
                    return changed ? newWeights : prev;
                });

                if (window.matchMedia('(prefers-color-scheme: dark)').matches) setIsDark(true);
            }, []);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({ schedule, essays, history, weights }));
                document.documentElement.classList.toggle('dark', isDark);
            }, [schedule, essays, history, weights, isDark]);

            // Actions
            const handleDragStart = (e, dayIdx, taskIdx) => {
                e.dataTransfer.setData("text/plain", JSON.stringify({ dayIdx, taskIdx }));
                e.currentTarget.classList.add('dragging'); 
            };

            const handleDragEnd = (e) => {
                e.currentTarget.classList.remove('dragging');
                document.querySelectorAll('.glass-card').forEach(el => el.classList.remove('drag-over'));
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                const card = e.currentTarget.closest('.glass-card');
                if (card) card.classList.add('drag-over');
            };
             const handleDragLeave = (e) => {
                const card = e.currentTarget.closest('.glass-card');
                if (card) card.classList.remove('drag-over');
            };

            const handleDrop = (e, targetDayIdx) => {
                e.preventDefault();
                document.querySelectorAll('.glass-card').forEach(el => el.classList.remove('drag-over'));
                const data = e.dataTransfer.getData("text/plain");
                if (!data) return;
                const { dayIdx: srcDay, taskIdx: srcTask } = JSON.parse(data);
                
                if (srcDay === targetDayIdx) return;

                const newSchedule = [...schedule];
                const [movedTask] = newSchedule[srcDay].tasks.splice(srcTask, 1);
                newSchedule[targetDayIdx].tasks.push(movedTask);
                setSchedule(newSchedule);
            };

            const updateTaskTimeAndName = (dayIdx, taskIdx, newPlanned, newStudied, newName) => {
                const newSchedule = [...schedule];
                const oldName = newSchedule[dayIdx].tasks[taskIdx].subject;
                
                newSchedule[dayIdx].tasks[taskIdx].planned = newPlanned;
                newSchedule[dayIdx].tasks[taskIdx].studied = newStudied;
                newSchedule[dayIdx].tasks[taskIdx].subject = newName;

                if (newName !== oldName) {
                    if(confirm(`Deseja renomear todas as ocorrências de "${oldName}" para "${newName}"?`)) {
                        newSchedule.forEach(day => {
                            day.tasks.forEach(task => {
                                if (task.subject === oldName) {
                                    task.subject = newName;
                                }
                            });
                        });
                        setWeights(prev => {
                            const updatedWeights = { ...prev };
                            if (updatedWeights[oldName]) {
                                updatedWeights[newName] = updatedWeights[oldName];
                                delete updatedWeights[oldName];
                            } else {
                                updatedWeights[newName] = 1;
                            }
                            return updatedWeights;
                        });
                    } else {
                        setWeights(prev => ({...prev, [newName]: prev[newName] || 1}));
                    }
                }

                setSchedule(newSchedule);
                setActiveModal(null);
            };


            const distributeHours = () => {
                const totalMinutes = grandTotalHours * 60;
                if (totalMinutes <= 0) return;

                let totalWeightPoints = 0;
                Object.values(weights).forEach(w => totalWeightPoints += w);
                if (totalWeightPoints === 0) totalWeightPoints = 1;

                const minsPerUnit = totalMinutes / totalWeightPoints;
                const subjectTotals = {};
                Object.keys(weights).forEach(sub => {
                    subjectTotals[sub] = weights[sub] * minsPerUnit;
                });

                const newSchedule = schedule.map(day => ({
                    ...day,
                    tasks: day.tasks.map(task => {
                        let occurrences = 0;
                        schedule.forEach(d => d.tasks.forEach(t => { if (t.subject === task.subject) occurrences++; }));
                        if (occurrences === 0) occurrences = 1;
                        const subjectTotal = subjectTotals[task.subject] || 0;
                        return { ...task, planned: Math.floor(subjectTotal / occurrences) };
                    })
                }));
                setSchedule(newSchedule);
                setActiveModal(null);
            };

            const finishWeek = (note) => {
                let planned = 0, studied = 0;
                schedule.forEach(d => d.tasks.forEach(t => { planned += t.planned; studied += t.studied; }));
                const entry = {
                    id: Date.now(),
                    dateISO: new Date().toISOString(),
                    weekRange: "Semana Concluída",
                    note,
                    percent: planned > 0 ? Math.round((studied / planned) * 100) : 0,
                    planned, studied
                };
                setHistory([entry, ...history]);
                setSchedule(schedule.map(d => ({ ...d, tasks: d.tasks.map(t => ({ ...t, studied: 0 })) })));
                setActiveModal('history');
            };

            const handleAddEssay = () => {
                if (!essayForm.theme || !essayForm.grade) {
                    alert("Preencha pelo menos o tema e a nota.");
                    return;
                }
                const newEssay = { 
                    id: Date.now(), 
                    theme: essayForm.theme, 
                    genre: essayForm.genre, 
                    grade: parseInt(essayForm.grade), 
                    date: new Date().toLocaleDateString('pt-BR') 
                };
                setEssays([newEssay, ...essays]);
                setEssayForm({ theme: '', genre: '', grade: '' }); // Reset form
                setActiveModal(null);
            };

            // Render Helpers
            const timeBank = useMemo(() => {
                let p = 0, s = 0;
                schedule.forEach(d => d.tasks.forEach(t => { p += t.planned; s += t.studied; }));
                return s - p;
            }, [schedule]);

            const pendingSubjects = useMemo(() => {
                const totals = {};
                schedule.forEach(d => d.tasks.forEach(t => {
                    if (!totals[t.subject]) totals[t.subject] = { planned: 0, studied: 0, color: COLORS[t.subject] || COLORS.Default };
                    totals[t.subject].planned += t.planned;
                    totals[t.subject].studied += t.studied;
                }));
                return Object.entries(totals)
                    .map(([s, v]) => ({ subject: s, color: v.color, remaining: v.planned - v.studied }))
                    .filter(x => x.remaining > 0)
                    .sort((a, b) => b.remaining - a.remaining);
            }, [schedule]);

            const getCalendarDays = () => {
                const year = currentCalendarDate.getFullYear();
                const month = currentCalendarDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const days = [];
                for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
                for (let i = 1; i <= lastDay.getDate(); i++) days.push(i);
                return days;
            };

            return (
                <div className="container mx-auto px-4 py-16 max-w-7xl">
                    {/* Header */}
                    <header className="text-center mb-24 animate-fade-in-up relative">
                         <div className="inline-block mb-8 px-6 py-2.5 rounded-full bg-indigo-100 dark:bg-indigo-500/10 text-indigo-700 dark:text-indigo-300 text-sm font-extrabold tracking-[0.2em] uppercase border border-indigo-200 dark:border-indigo-500/20 shadow-sm">
                            Student Dashboard V3.8
                        </div>
                        <h1 className="text-7xl md:text-9xl font-display font-black tracking-tighter mb-8 text-slate-900 dark:text-white leading-none drop-shadow-sm">
                            <span className="block mb-2 text-transparent bg-clip-text bg-gradient-to-br from-slate-800 to-slate-500 dark:from-white dark:to-slate-500">Meu</span>
                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-violet-600 to-purple-600 dark:from-indigo-400 dark:via-violet-400 dark:to-purple-400">Cronograma</span>
                        </h1>
                         <div className="flex flex-wrap justify-center gap-5">
                            <button onClick={() => setActiveModal('settings')} className="group relative px-8 py-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl font-bold text-lg text-slate-700 dark:text-slate-200 hover:border-indigo-500 dark:hover:border-indigo-500 transition-all shadow-lg hover:shadow-indigo-500/20 hover:-translate-y-1 flex items-center gap-3">
                                <svg className="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                Configurar Metas
                            </button>
                             <button onClick={() => setActiveModal('history')} className="group relative px-8 py-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl font-bold text-lg text-slate-700 dark:text-slate-200 hover:border-emerald-500 dark:hover:border-emerald-500 transition-all shadow-lg hover:shadow-emerald-500/20 hover:-translate-y-1 flex items-center gap-3">
                                <svg className="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                Calendário & Histórico
                            </button>
                        </div>
                    </header>

                    {/* Time Bank */}
                    <div className="glass-card rounded-3xl p-10 mb-16 text-center transform hover:scale-[1.02] transition-all duration-500">
                        <h2 className="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Saldo da Semana</h2>
                         <div className="flex justify-center items-baseline gap-2">
                             <p className="text-7xl md:text-8xl font-display font-bold tracking-tighter transition-colors duration-300 bg-clip-text text-transparent bg-gradient-to-b from-slate-800 to-slate-600 dark:from-white dark:to-slate-400">
                                {formatTime(timeBank)}
                             </p>
                         </div>
                         <p className="mt-4 text-lg font-medium text-slate-600 dark:text-slate-300">Seu saldo de estudos.</p>
                    </div>

                    {/* Schedule */}
                    <main className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                        {schedule.map((dayData, dIdx) => (
                            <div key={dayData.day || dIdx} 
                                 className="glass-card rounded-[2rem] p-6 min-h-[200px] flex flex-col transition-colors duration-300"
                                 onDragOver={handleDragOver} onDragLeave={handleDragLeave} onDrop={(e) => handleDrop(e, dIdx)}>
                                <div className="flex justify-between items-center mb-6 pl-1">
                                    <h2 className="text-2xl font-display font-bold text-slate-800 dark:text-white">{dayData.day}</h2>
                                    <span className="text-xs font-bold bg-white dark:bg-slate-800 text-slate-400 px-3 py-1 rounded-full border border-slate-100 dark:border-slate-700 shadow-sm">{dayData.tasks.length}</span>
                                </div>
                                <div className="flex-grow min-h-[80px] space-y-3">
                                    {dayData.tasks.map((task, tIdx) => {
                                        const color = COLORS[task.subject] || COLORS.Default;
                                        const progress = task.planned > 0 ? (task.studied / task.planned) * 100 : 0;
                                        const isDone = task.planned > 0 && task.studied >= task.planned;
                                        
                                        return (
                                            <div key={task.id || tIdx} 
                                                 draggable onDragStart={(e) => handleDragStart(e, dIdx, tIdx)} onDragEnd={handleDragEnd}
                                                 onClick={() => { setSelectedTask({ ...task, dIdx, tIdx }); setActiveModal('task'); }}
                                                 className="task-item group bg-white dark:bg-slate-800/50 p-4 rounded-2xl mb-3 border border-transparent hover:border-indigo-100 dark:hover:border-indigo-900/50 hover:shadow-md transition-all flex items-center gap-4">
                                                <div className="relative w-12 h-12 flex-shrink-0">
                                                    <svg className="w-full h-full -rotate-90">
                                                        <circle cx="24" cy="24" r="22" stroke="currentColor" strokeWidth="4" fill="transparent" className="text-slate-100 dark:text-slate-700" />
                                                        <circle cx="24" cy="24" r="22" stroke={color} strokeWidth="4" fill="transparent" strokeDasharray={138} strokeDashoffset={138 - (Math.min(progress, 100)/100)*138} strokeLinecap="round" />
                                                    </svg>
                                                    <div className="absolute inset-0 flex items-center justify-center text-sm font-bold" style={{color}}>
                                                        {isDone ? '✓' : task.subject.charAt(0)}
                                                    </div>
                                                </div>
                                                <div className="flex-grow min-w-0">
                                                    <h4 className="font-display font-bold text-slate-800 dark:text-slate-100 text-lg leading-tight truncate">{task.subject}</h4>
                                                    <div className="flex justify-between items-center mt-1">
                                                        <span className="text-xs font-medium text-slate-400">{isDone ? 'CONCLUÍDO' : `Meta: ${formatTime(task.planned)}`}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {dayData.tasks.length === 0 && <div className="h-full flex items-center justify-center border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl text-slate-400 text-xs font-bold uppercase tracking-widest py-12 opacity-50">Vazio</div>}
                                </div>
                            </div>
                        ))}
                    </main>

                    {/* Pending */}
                    <div className="glass-card rounded-3xl p-8 mt-12 border-l-4 border-rose-500">
                         <div className="flex items-center justify-between mb-8 pb-4 border-b border-slate-200/60 dark:border-slate-700/60">
                            <h2 className="text-3xl font-display font-bold text-slate-800 dark:text-white">Pendências</h2>
                            <span className="text-xs font-bold bg-rose-100 dark:bg-rose-500/20 text-rose-600 dark:text-rose-300 px-4 py-1.5 rounded-full uppercase tracking-widest">Atenção</span>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {pendingSubjects.length === 0 ? <div className="col-span-full text-center text-emerald-500 font-bold">Tudo completo!</div> : pendingSubjects.map((item, i) => (
                                <div key={i} className="relative overflow-hidden p-5 bg-white dark:bg-slate-800/50 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 group hover:shadow-lg transition-all">
                                    <div className="absolute left-0 top-0 bottom-0 w-1.5" style={{backgroundColor: item.color}}></div>
                                    <div className="flex justify-between items-center pl-3">
                                        <div className="flex-1 min-w-0 mr-2">
                                            <h4 className="font-bold text-lg text-slate-700 dark:text-slate-200 truncate">{item.subject}</h4>
                                        </div>
                                        <div className="text-right whitespace-nowrap">
                                            <span className="text-xl font-display font-black text-slate-800 dark:text-white tracking-tight">
                                                {formatTime(item.remaining)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Redações */}
                    <div className="glass-card rounded-3xl p-8 mt-12 border-l-4 border-indigo-500">
                        <div className="flex flex-col sm:flex-row items-center justify-between mb-8 pb-4 border-b border-slate-200/60 dark:border-slate-700/60 gap-4">
                            <div><h2 className="text-3xl font-display font-bold text-slate-800 dark:text-white">Minhas Redações</h2></div>
                            <button onClick={() => { setEssayForm({theme:'', genre:'', grade:''}); setActiveModal('essay'); }} className="w-full sm:w-auto bg-slate-900 dark:bg-white dark:text-slate-900 text-white text-sm font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4"></path></svg>Nova Redação</button>
                        </div>
                        <div className="space-y-3">
                            {essays.length === 0 && <p className="text-slate-400 text-center italic">Nenhuma redação registrada.</p>}
                            {essays.map(essay => (
                                <div key={essay.id} className="flex items-center justify-between p-4 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-100 dark:border-slate-800 hover:border-indigo-200 transition group">
                                    <div className="flex-1 min-w-0 mr-4"><h4 className="font-bold text-slate-800 dark:text-white truncate">{essay.theme}</h4><div className="flex items-center gap-2 mt-1 text-xs font-medium text-slate-400"><span class="bg-slate-100 dark:bg-slate-900 px-2 py-0.5 rounded text-slate-500">{essay.genre}</span><span>{essay.date}</span></div></div>
                                    <div className="flex items-center gap-4"><span className={`text-xl font-display font-bold ${essay.grade >= 900 ? 'text-emerald-500' : 'text-indigo-500'}`}>{essay.grade}</span></div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Footer Button - Hero Style */}
                    <div className="text-center mt-20 pb-20">
                         <button onClick={() => setActiveModal('finish')} 
                            className="group relative inline-flex items-center justify-center px-10 py-6 font-bold text-white transition-all duration-200 bg-gradient-to-r from-emerald-500 to-teal-600 font-display rounded-full hover:from-emerald-600 hover:to-teal-700 shadow-xl shadow-emerald-500/30 hover:shadow-2xl hover:shadow-emerald-500/40 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-600 active:scale-95 w-full sm:w-auto">
                            <span className="mr-3 text-2xl tracking-wide">CONCLUIR SEMANA</span>
                            <svg className="w-8 h-8 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                         </button>
                         <p className="text-slate-400 font-medium text-sm mt-6 opacity-80">Clique para salvar seu progresso no calendário e iniciar um novo ciclo.</p>
                    </div>

                    {/* Modals */}
                    
                    {/* Edit Task Modal */}
                    <Modal isOpen={activeModal === 'task'} onClose={() => setActiveModal(null)} title="Editar Matéria">
                         {selectedTask && (
                            <div className="space-y-6">
                                <div className="bg-indigo-50 dark:bg-indigo-900/20 p-6 rounded-2xl border border-indigo-100 dark:border-indigo-500/20">
                                     <label className="block text-xs font-bold text-indigo-500 mb-1 uppercase text-center">Nome da Matéria</label>
                                     <input type="text" id="editSubjectName" defaultValue={selectedTask.subject} className="w-full text-center text-3xl font-display font-bold text-indigo-600 dark:text-indigo-400 bg-transparent border-b border-transparent hover:border-indigo-300 focus:border-indigo-500 outline-none transition" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Planejado (Min)</label>
                                        <input type="number" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 font-bold text-slate-900 dark:text-white" defaultValue={selectedTask.planned} id="editPlanned" />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 mb-1 uppercase">Estudado (Min)</label>
                                        <input type="number" className="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 font-bold text-slate-900 dark:text-white" defaultValue={selectedTask.studied} id="editStudied" />
                                    </div>
                                </div>
                                <button onClick={() => {
                                    const p = parseInt(document.getElementById('editPlanned').value) || 0;
                                    const s = parseInt(document.getElementById('editStudied').value) || 0;
                                    const nName = document.getElementById('editSubjectName').value.trim();
                                    if(nName) updateTaskTimeAndName(selectedTask.dIdx, selectedTask.tIdx, p, s, nName);
                                }} className="w-full py-4 rounded-xl font-bold text-white bg-indigo-600 hover:bg-indigo-500 shadow-lg">Salvar</button>
                            </div>
                         )}
                    </Modal>
                    
                    {/* Settings Modal (Weights) */}
                    <Modal isOpen={activeModal === 'settings'} onClose={() => setActiveModal(null)} title="Configurar Pesos">
                        <div className="p-6 mb-6 bg-indigo-50 dark:bg-indigo-500/10 rounded-2xl border border-indigo-100 dark:border-indigo-500/20 flex justify-between items-center">
                             <div>
                                <label className="block text-xs font-bold text-indigo-800 dark:text-indigo-300 mb-1 uppercase">Meta Semanal (Horas)</label>
                                <input type="number" value={grandTotalHours} onChange={(e) => setGrandTotalHours(parseInt(e.target.value)||0)} className="text-3xl font-bold bg-transparent text-indigo-600 dark:text-indigo-400 outline-none w-32 border-b-2 border-indigo-300" />
                             </div>
                             <button onClick={distributeHours} className="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold shadow-md hover:bg-indigo-700">Calcular e Aplicar</button>
                        </div>
                        <div className="space-y-3 max-h-[50vh] overflow-y-auto">
                            {Object.keys(weights).sort().map(s => (
                                <div key={s} className="flex justify-between items-center p-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-100 dark:border-slate-800">
                                    <div className="flex items-center gap-3">
                                        <div className="w-3 h-3 rounded-full" style={{backgroundColor: COLORS[s] || '#ccc'}}></div>
                                        <span className="font-bold text-slate-700 dark:text-white text-lg">{s}</span>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-xs font-bold text-slate-400 uppercase">Peso</span>
                                        <button onClick={() => setWeights({...weights, [s]: Math.max(1, weights[s]-1)})} className="w-8 h-8 bg-white dark:bg-slate-900 rounded-lg font-bold text-slate-900 dark:text-white">-</button>
                                        <span className="font-bold w-4 text-center dark:text-white">{weights[s]}</span>
                                        <button onClick={() => setWeights({...weights, [s]: Math.min(5, weights[s]+1)})} className="w-8 h-8 bg-white dark:bg-slate-900 rounded-lg font-bold text-slate-900 dark:text-white">+</button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </Modal>
                    
                    {/* History Modal (Calendar) */}
                    <Modal isOpen={activeModal === 'history'} onClose={() => setActiveModal(null)} title="Histórico">
                        <div className="flex flex-col md:flex-row gap-8">
                            <div className="w-full md:w-1/2">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-bold dark:text-white">Calendário</h3>
                                    <div className="flex gap-2">
                                        <button onClick={() => setCurrentCalendarDate(new Date(currentCalendarDate.setMonth(currentCalendarDate.getMonth()-1)))} className="p-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white">←</button>
                                        <span className="font-bold dark:text-white min-w-[100px] text-center">{currentCalendarDate.toLocaleDateString('pt-BR', {month:'long'})}</span>
                                        <button onClick={() => setCurrentCalendarDate(new Date(currentCalendarDate.setMonth(currentCalendarDate.getMonth()+1)))} className="p-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white">→</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-7 gap-2">
                                    {getCalendarDays().map((d, i) => {
                                        if(!d) return <div key={i} className="calendar-day empty"></div>;
                                        const dateCheck = `${currentCalendarDate.getFullYear()}-${String(currentCalendarDate.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                                        const hasEntry = history.some(h => h.dateISO.startsWith(dateCheck));
                                        return <div key={i} className={`calendar-day text-slate-600 dark:text-slate-300 bg-slate-50 dark:bg-slate-800 ${hasEntry ? 'has-history !bg-indigo-500 !text-white' : ''}`}>{d}</div>;
                                    })}
                                </div>
                            </div>
                            <div className="w-full md:w-1/2 border-l border-slate-100 dark:border-slate-700 pl-8">
                                <h3 className="text-xl font-bold dark:text-white mb-4">Registros</h3>
                                <div className="space-y-3 max-h-[400px] overflow-y-auto">
                                    {history.length === 0 && <p className="text-slate-400">Sem histórico.</p>}
                                    {history.map(h => (
                                        <div key={h.id} className="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-100 dark:border-slate-800">
                                            <div className="flex justify-between mb-1">
                                                <span className="font-bold dark:text-white">{new Date(h.dateISO).toLocaleDateString()}</span>
                                                <span className="font-bold text-indigo-500">{h.percent}%</span>
                                            </div>
                                            <p className="text-sm text-slate-500 italic">"{h.note || 'Sem nota'}"</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </Modal>

                    {/* Finish Week Modal */}
                    <Modal isOpen={activeModal === 'finish'} onClose={() => setActiveModal(null)} title="Concluir Semana">
                        <p className="text-slate-500 mb-4">Salve o progresso e inicie uma nova semana.</p>
                        <textarea id="finishNote" className="w-full p-4 bg-slate-50 dark:bg-slate-900 rounded-2xl outline-none focus:ring-2 ring-emerald-500 min-h-[100px] text-slate-900 dark:text-white" placeholder="Notas sobre a semana..."></textarea>
                        <div className="flex gap-3 mt-6">
                             <button onClick={() => setActiveModal(null)} className="flex-1 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800">Cancelar</button>
                             <button onClick={() => finishWeek(document.getElementById('finishNote').value)} className="flex-1 py-3 rounded-xl font-bold text-white bg-emerald-600 hover:bg-emerald-500 shadow-lg">Salvar</button>
                        </div>
                    </Modal>
                    
                    {/* Essay Modal */}
                    <Modal isOpen={activeModal === 'essay'} onClose={() => setActiveModal(null)} title="Nova Redação">
                        <div className="space-y-4">
                            <input 
                                placeholder="Tema" 
                                value={essayForm.theme}
                                onChange={e => setEssayForm({...essayForm, theme: e.target.value})}
                                className="w-full p-3 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded-xl font-medium outline-none focus:ring-2 ring-indigo-500 placeholder-slate-400" 
                            />
                             <input 
                                placeholder="Gênero (Ex: Dissertação)" 
                                value={essayForm.genre}
                                onChange={e => setEssayForm({...essayForm, genre: e.target.value})}
                                className="w-full p-3 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded-xl font-medium outline-none focus:ring-2 ring-indigo-500 placeholder-slate-400" 
                            />
                            <input 
                                type="number" 
                                placeholder="Nota (0-1000)" 
                                max="1000" 
                                value={essayForm.grade}
                                onChange={e => setEssayForm({...essayForm, grade: e.target.value})}
                                className="w-full p-3 bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white rounded-xl font-medium outline-none focus:ring-2 ring-indigo-500 placeholder-slate-400" 
                            />
                            <button onClick={handleAddEssay} className="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-500">Adicionar</button>
                        </div>
                    </Modal>
                    
                    {/* Toggle Theme & Help */}
                    <button onClick={() => setIsDark(!isDark)} className="fixed top-6 right-6 z-40 p-3 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-md shadow-lg border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:scale-110 transition-all">
                        {isDark ? <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fillRule="evenodd" clipRule="evenodd"></path></svg> : <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>}
                    </button>

                    <button onClick={() => setShowHelp(!showHelp)} className="fixed bottom-6 right-6 z-40 p-4 rounded-full bg-indigo-600 shadow-xl text-white hover:bg-indigo-700 transition-colors">
                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8.228 9c0-1.5 2.5-3 2.5-3s2.5 1.5 2.5 3c0 1.5-2.5 3-2.5 3s-2.5-1.5-2.5-3zM12 21h.01M17 14h.01M12 3h.01M7 14h.01M12 14v-2"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h8m-4 4v-4m0 0V8m0 0v-4"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 21a9 9 0 100-18 9 9 0 000 18z"></path></svg>
                    </button>

                    <div className={`fixed bottom-24 right-6 z-30 max-w-xs bg-white/90 dark:bg-slate-900/90 backdrop-blur-md rounded-2xl p-5 shadow-2xl border border-slate-200 dark:border-slate-700 transition-all duration-300 ${showHelp ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10 pointer-events-none'}`}>
                        <h4 className="font-bold mb-2 dark:text-white">Ajuda Rápida</h4>
                        <p className="text-sm text-slate-600 dark:text-slate-400">
                            <b>Renomear Matéria:</b> Clique em qualquer matéria na semana e edite o nome no topo do cartão.<br/><br/>
                            Use o botão <b>Configurar Metas</b> para ajustar pesos (1-5).
                        </p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
